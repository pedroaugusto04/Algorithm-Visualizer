<div class="content">
    <div class="form-container">
        <div class="row">
            <div class="col-sm-12">
                <mat-label class="f-s-14 f-w-600 d-block m-b-16">Execution Settings</mat-label>
            </div>

            <div class="col-sm-12 m-b-16">
                <mat-form-field appearance="outline" class="w-100">
                    <mat-label>Language</mat-label>
                    <mat-select [formControl]="languageControl">
                        <mat-option value="cpp17">C++ 17</mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-100">
                    <mat-label>Platform</mat-label>
                    <mat-select [formControl]="platformControl">
                        <mat-option value="leetcode">LeetCode</mat-option>
                        <mat-option value="codeforces">Codeforces</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <div class="col-sm-12">
                <mat-label class="f-s-12 f-w-600">Source Code</mat-label>
                <mat-form-field appearance="outline" class="w-100 code-field">
                    <textarea matInput rows="10" placeholder="Paste your code here..." [ngModel]="sourceCode()"
                        (ngModelChange)="sourceCode.set($event)" (paste)="onPaste($event)">
                    </textarea>
                </mat-form-field>
            </div>

            <div class="col-sm-12 m-t-16">
                @if (platformControl.value === 'leetcode') {
                <mat-form-field appearance="outline" class="w-100">
                    <mat-label>LeetCode Test Case</mat-label>
                    <textarea matInput placeholder="e.g. [1,2,3], target = 5" [ngModel]="testCaseInput()"
                        (ngModelChange)="testCaseInput.set($event)">
                    </textarea>
                </mat-form-field>
                } @else if (platformControl.value === 'codeforces') {
                <div class="file-upload-box">
                    <mat-label class="d-block m-b-8">Upload Input File (.in)</mat-label>
                    <button mat-stroked-button type="button" (click)="fileInput.click()">
                        <mat-icon>upload_file</mat-icon> Select File
                    </button>
                    <input #fileInput type="file" (change)="onFileSelected($event)" style="display:none" />

                    @if (selectedFileName()) {
                    <span class="f-s-12 d-block m-t-8"><strong>Selected:</strong> {{ selectedFileName() }}</span>
                    }
                </div>
                }
            </div>

            <div class="col-sm-12 m-t-24">
                <button class="run-button" mat-flat-button color="warn" (click)="onRunCode()" [disabled]="isPlaying()">
                    <mat-icon>play_arrow</mat-icon> RUN CODE
                </button>
            </div>
        </div>
    </div>

    <div class="visualization-container">
        @if (totalSteps() > 0) {
        <div class="animation-player">
            <div class="controls-row">
                <button mat-icon-button (click)="prevStep()" [disabled]="currentStep() === 0">
                    <mat-icon>skip_previous</mat-icon>
                </button>

                <button mat-mini-fab color="primary" (click)="togglePlay()">
                    <mat-icon>{{ isPlaying() ? 'pause' : 'play_arrow' }}</mat-icon>
                </button>

                <button mat-icon-button (click)="nextStep()" [disabled]="currentStep() >= totalSteps() - 1">
                    <mat-icon>skip_next</mat-icon>
                </button>

                <div class="toggle-container">
                    <mat-slide-toggle color="accent" [checked]="autoSwitchTabs()"
                        (change)="autoSwitchTabs.set($any($event).checked)">
                        <span class="f-s-12">Auto-switch Tabs</span>
                    </mat-slide-toggle>
                </div>
            </div>

            <div class="slider-row">
                <span class="step-label">Step {{ currentStep() + 1 }} of {{ totalSteps() }}</span>
                <input type="range" class="custom-slider" [min]="0" [max]="totalSteps() - 1" [value]="currentStep()"
                    (input)="onSliderInput($any($event.target).valueAsNumber)" (change)="onSliderChange()">
            </div>
        </div>
        }

        <mat-tab-group animationDuration="0ms" [selectedIndex]="selectedTabIndex()"
            (selectedIndexChange)="selectedTabIndex.set($event)" (click)="setTabManully($event)">
            @for (struct of structures; track struct.path) {
            <mat-tab [labelClass]="struct.isHighlighting ? 'glow-active' : ''">
                <ng-template mat-tab-label>
                    {{ struct.path }} ({{ struct.type | titlecase }})
                </ng-template>
                <div class="structure-render">
                    @if (hasData(struct)) {
                    <app-structure-visualizer [struct]="struct"></app-structure-visualizer>
                    } @else {
                    <div class="empty-structure-state">
                        <mat-icon>analytics</mat-icon>
                        <p>Waiting for operations in <strong>{{ struct.path }}</strong>...</p>
                        <span>Advance the steps to visualize the structure.</span>
                    </div>
                    }
                </div>
            </mat-tab>
            }

            <mat-tab label="Output Console">
                <div class="console-output">
                    <pre><code>{{ executionResult() || 'Waiting for execution...' }}</code></pre>
                </div>
            </mat-tab>
        </mat-tab-group>
    </div>
</div>